# 幼儿园老师 Agent 测试规格

## 1. 测试策略

| 类型 | 范围 | 工具/方法 | 责任人 |
|------|------|----------|--------|
| 单元测试 | 后端 Service、工具类 | JUnit 5 + Mockito | 开发 |
| 单元测试 | 前端组件、Hooks、工具函数 | Vitest + React Testing Library | 开发 |
| 集成测试 | API、数据库、Redis | Spring Boot Test / TestContainers | 开发 |
| E2E 测试 | 关键用户流程 | Playwright / Cypress | QA |
| 人工验收 | 文案质量、交互体验 | 检查清单 | 产品/QA |

---

## 2. 测试用例清单

### 2.1 认证与用户

| 用例ID | 模块 | 场景 | 预期结果 |
|--------|------|------|----------|
| AUTH-01 | 登录 | 正确手机号+验证码 | 登录成功，跳转工作台 |
| AUTH-02 | 登录 | 错误验证码 | 提示错误，不跳转 |
| AUTH-03 | 登录 | 正确邮箱+密码 | 登录成功 |
| AUTH-04 | 登录 | 错误密码 | 提示错误 |
| AUTH-05 | 注册 | 新用户完整注册 | 注册成功，自动登录 |
| AUTH-06 | 注册 | 重复手机号/邮箱 | 提示已存在 |
| AUTH-07 | 登出 | 已登录用户点击登出 | 清除登录态，跳转登录页 |
| AUTH-08 | Token | Token 过期访问 API | 401，跳转登录页 |
| USER-01 | 个人资料 | 修改昵称/头像 | 修改成功，界面刷新 |
| USER-02 | 密码 | 修改密码 | 修改成功，需重新登录 |

### 2.2 会话管理

| 用例ID | 模块 | 场景 | 预期结果 |
|--------|------|------|----------|
| SESS-01 | 会话 | 新建会话 | 创建成功，切换到新会话 |
| SESS-02 | 会话 | 切换已有会话 | 加载该会话消息 |
| SESS-03 | 会话 | 删除会话 | 删除成功，列表更新 |
| SESS-04 | 会话 | 未登录访问会话列表 | 401，跳转登录 |
| SESS-05 | 会话 | 分页加载 | 正确分页，无重复 |

### 2.3 文案生成

| 用例ID | 模块 | 场景 | 预期结果 |
|--------|------|------|----------|
| GEN-01 | 生成 | 选择文案类型+输入需求+生成 | 流式输出，保存到会话 |
| GEN-02 | 生成 | 未选文案类型直接生成 | 提示需选择文案类型 |
| GEN-03 | 生成 | 空输入生成 | 提示输入不能为空 |
| GEN-04 | 生成 | 调整年龄段/风格/字数后生成 | 输出符合参数 |
| GEN-05 | 生成 | 勾选使用知识库 | 输出中体现知识库内容 |
| GEN-06 | 生成 | 超过每日额度 | 提示额度已用完，引导订阅 |
| GEN-07 | 生成 | 复制生成结果 | 内容正确复制到剪贴板 |
| GEN-08 | 生成 | 重新生成 | 生成新内容，替换原消息 |

### 2.4 知识库

| 用例ID | 模块 | 场景 | 预期结果 |
|--------|------|------|----------|
| KB-01 | 知识库 | 上传 PDF | 上传成功，进入解析 |
| KB-02 | 知识库 | 上传 Word | 上传成功，进入解析 |
| KB-03 | 知识库 | 上传超大小文件 | 提示超出限制 |
| KB-04 | 知识库 | 上传非支持类型 | 提示不支持格式 |
| KB-05 | 知识库 | 查看文件列表 | 正确展示已上传文件 |
| KB-06 | 知识库 | 删除文件 | 删除成功，列表更新 |
| KB-07 | 知识库 | 解析完成状态 | 状态正确展示 |
| KB-08 | 知识库 | 未订阅用户上传 | 根据套餐限制提示 |

### 2.5 订阅

| 用例ID | 模块 | 场景 | 预期结果 |
|--------|------|------|----------|
| SUB-01 | 订阅 | 查看套餐列表 | 正确展示套餐与价格 |
| SUB-02 | 订阅 | 查看当前订阅状态 | 正确展示有效期、额度 |
| SUB-03 | 订阅 | 查看用量统计 | 正确展示今日/本月用量 |
| SUB-04 | 订阅 | 创建订阅订单 | 跳转支付或展示支付信息 |
| SUB-05 | 订阅 | 订阅生效后 | 额度/功能正确解锁 |

---

## 3. 文案质量验收标准

### 3.1 专业性

| 维度 | 标准 |
|------|------|
| 术语 | 符合幼教行业常用表述 |
| 规范 | 符合《3-6岁儿童学习与发展指南》等政策导向 |
| 年龄段 | 内容难度与所选年龄段匹配 |
| 结构 | 结构完整，有导入/展开/总结等合理框架 |

### 3.2 无幻觉

| 维度 | 标准 |
|------|------|
| 事实 | 政策名称、年龄划分、活动建议等不编造 |
| 引用 | 若有引用，来源可追溯 |
| 逻辑 | 前后一致，无明显矛盾 |

### 3.3 结构完整

| 文案类型 | 必备结构 |
|----------|----------|
| 活动教案 | 活动目标、活动准备、活动过程、活动延伸 |
| 观察记录 | 观察对象、观察时间、观察内容、分析与建议 |
| 家长会发言 | 开场、主要内容、总结、互动环节 |
| 安全教育方案 | 目标、内容、形式、时间安排、注意事项 |

### 3.4 风格匹配

| 风格 | 预期特征 |
|------|----------|
| 活泼 | 语言生动、有互动感 |
| 严谨 | 用语规范、逻辑清晰 |
| 温馨 | 语气亲切、体现关怀 |
| 专业 | 术语准确、表述专业 |
| 简洁 | 重点突出、不冗长 |

### 3.5 人工验收检查点

- [ ] 输出无敏感/不当内容
- [ ] 无明显的模板化套话堆积
- [ ] 内容有针对性，非泛泛而谈
- [ ] 字数大致符合设定（允许 ±20%）
- [ ] 格式正确，无乱码或重复段落

---

## 4. 性能与安全测试

### 4.1 性能

| 指标 | 目标 | 方法 |
|------|------|------|
| 首屏加载 | ≤ 3s | Lighthouse / 手工计时 |
| 生成首字 | ≤ 5s | 流式接口计时 |
| 并发生成 | 50 用户同时生成无崩溃 | 压力测试 |
| 大列表 | 100+ 会话列表加载流畅 | 分页/虚拟滚动 |

### 4.2 安全

| 项目 | 检查点 |
|------|--------|
| 认证 | Token 正确校验，过期拒绝 |
| 权限 | 用户仅能访问自己的会话、知识库、订阅 |
| 输入 | 特殊字符、超长输入不导致异常 |
| 文件上传 | 类型校验、大小限制、无路径穿越 |

---

## 5. 测试环境与数据

### 5.1 环境

- 开发环境：本地 Docker / 本地服务
- 测试环境：独立数据库、Redis、向量库，与生产隔离
- 大模型：建议使用测试用 API Key 或 Mock

### 5.2 测试数据

- 用户：若干测试账号（免费/付费各一）
- 会话：预置多条不同文案类型的对话
- 知识库：预置若干已解析文件
- 订阅：预置有效/过期订阅数据

### 5.3 Mock 建议

- LLM 接口可 Mock 固定返回，用于不依赖模型的自动化测试
- 支付接口使用沙箱环境

---

## 6. 自动化测试建议

### 6.1 后端（JUnit）

```
src/test/java/
├── service/
│   ├── GenerateServiceTest.java
│   ├── KnowledgeServiceTest.java
│   └── ...
├── controller/
│   └── AuthControllerTest.java  # MockMvc
└── integration/
    └── ApiIntegrationTest.java  # TestContainers
```

- Service 层：Mock 依赖，验证业务逻辑
- Controller 层：MockMvc 验证 HTTP 请求/响应
- 集成测试：启动真实数据库/Redis，验证端到端

### 6.2 前端（Vitest）

```
src/
├── __tests__/
│   ├── components/
│   │   ├── ChatInput.test.tsx
│   │   └── MessageList.test.tsx
│   ├── hooks/
│   └── utils/
```

- 组件：渲染、用户交互、状态变化
- Hooks：输入输出、副作用
- 工具函数：纯函数全覆盖

### 6.3 E2E（Playwright / Cypress）

```
e2e/
├── auth.spec.ts      # 登录、注册、登出
├── chat.spec.ts      # 创建会话、生成、复制
├── knowledge.spec.ts # 上传、删除
└── subscription.spec.ts
```

- 关键路径：登录 → 选择类型 → 输入 → 生成 → 复制
- 支持 headless 与有头模式
- 可配置 baseURL、超时
